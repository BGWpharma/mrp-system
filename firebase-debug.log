[debug] [2025-07-18T11:15:13.001Z] ----------------------------------------------------------------------
[debug] [2025-07-18T11:15:13.004Z] Command:       C:\Program Files\nodejs\node.exe C:\Users\mateu\AppData\Roaming\npm\node_modules\firebase-tools\lib\bin\firebase.js deploy --only storage --debug
[debug] [2025-07-18T11:15:13.004Z] CLI Version:   14.7.0
[debug] [2025-07-18T11:15:13.004Z] Platform:      win32
[debug] [2025-07-18T11:15:13.004Z] Node Version:  v22.16.0
[debug] [2025-07-18T11:15:13.004Z] Time:          Fri Jul 18 2025 13:15:13 GMT+0200 (czas środkowoeuropejski letni)
[debug] [2025-07-18T11:15:13.005Z] ----------------------------------------------------------------------
[debug] 
[debug] [2025-07-18T11:15:13.202Z] > command requires scopes: ["email","openid","https://www.googleapis.com/auth/cloudplatformprojects.readonly","https://www.googleapis.com/auth/firebase","https://www.googleapis.com/auth/cloud-platform"]
[debug] [2025-07-18T11:15:13.203Z] > authorizing via signed-in user (mateusz@bgwpharma.com)
[debug] [2025-07-18T11:15:13.204Z] [iam] checking project bgw-mrp-system for permissions ["firebase.projects.get","firebaserules.releases.create","firebaserules.releases.update","firebaserules.rulesets.create"]
[debug] [2025-07-18T11:15:13.205Z] Checked if tokens are valid: true, expires at: 1752838891074
[debug] [2025-07-18T11:15:13.205Z] Checked if tokens are valid: true, expires at: 1752838891074
[debug] [2025-07-18T11:15:13.206Z] >>> [apiv2][query] POST https://cloudresourcemanager.googleapis.com/v1/projects/bgw-mrp-system:testIamPermissions [none]
[debug] [2025-07-18T11:15:13.206Z] >>> [apiv2][(partial)header] POST https://cloudresourcemanager.googleapis.com/v1/projects/bgw-mrp-system:testIamPermissions x-goog-quota-user=projects/bgw-mrp-system
[debug] [2025-07-18T11:15:13.206Z] >>> [apiv2][body] POST https://cloudresourcemanager.googleapis.com/v1/projects/bgw-mrp-system:testIamPermissions {"permissions":["firebase.projects.get","firebaserules.releases.create","firebaserules.releases.update","firebaserules.rulesets.create"]}
[debug] [2025-07-18T11:15:14.110Z] <<< [apiv2][status] POST https://cloudresourcemanager.googleapis.com/v1/projects/bgw-mrp-system:testIamPermissions 200
[debug] [2025-07-18T11:15:14.110Z] <<< [apiv2][body] POST https://cloudresourcemanager.googleapis.com/v1/projects/bgw-mrp-system:testIamPermissions {"permissions":["firebase.projects.get","firebaserules.releases.create","firebaserules.releases.update","firebaserules.rulesets.create"]}
[info] 
[info] === Deploying to 'bgw-mrp-system'...
[info] 
[info] i  deploying storage 
[info] i  storage: ensuring required API firebasestorage.googleapis.com is enabled... 
[debug] [2025-07-18T11:15:14.113Z] Checked if tokens are valid: true, expires at: 1752838891074
[debug] [2025-07-18T11:15:14.113Z] Checked if tokens are valid: true, expires at: 1752838891074
[debug] [2025-07-18T11:15:14.113Z] >>> [apiv2][query] GET https://serviceusage.googleapis.com/v1/projects/bgw-mrp-system/services/firebasestorage.googleapis.com [none]
[debug] [2025-07-18T11:15:14.113Z] >>> [apiv2][(partial)header] GET https://serviceusage.googleapis.com/v1/projects/bgw-mrp-system/services/firebasestorage.googleapis.com x-goog-quota-user=projects/bgw-mrp-system
[debug] [2025-07-18T11:15:15.118Z] <<< [apiv2][status] GET https://serviceusage.googleapis.com/v1/projects/bgw-mrp-system/services/firebasestorage.googleapis.com 200
[debug] [2025-07-18T11:15:15.119Z] <<< [apiv2][body] GET https://serviceusage.googleapis.com/v1/projects/bgw-mrp-system/services/firebasestorage.googleapis.com [omitted]
[info] +  storage: required API firebasestorage.googleapis.com is enabled 
[debug] [2025-07-18T11:15:15.119Z] Checked if tokens are valid: true, expires at: 1752838891074
[debug] [2025-07-18T11:15:15.119Z] Checked if tokens are valid: true, expires at: 1752838891074
[debug] [2025-07-18T11:15:15.120Z] >>> [apiv2][query] GET https://firebasestorage.googleapis.com/v1alpha/projects/bgw-mrp-system/defaultBucket [none]
[debug] [2025-07-18T11:15:15.630Z] <<< [apiv2][status] GET https://firebasestorage.googleapis.com/v1alpha/projects/bgw-mrp-system/defaultBucket 200
[debug] [2025-07-18T11:15:15.630Z] <<< [apiv2][body] GET https://firebasestorage.googleapis.com/v1alpha/projects/bgw-mrp-system/defaultBucket {"name":"projects/bgw-mrp-system/defaultBucket","location":"US-CENTRAL1","bucket":{"name":"projects/bgw-mrp-system/buckets/bgw-mrp-system.firebasestorage.app"},"storageClass":"REGIONAL"}
[info] i  firebase.storage: checking storage.rules for compilation errors... 
[debug] [2025-07-18T11:15:15.632Z] Checked if tokens are valid: true, expires at: 1752838891074
[debug] [2025-07-18T11:15:15.632Z] Checked if tokens are valid: true, expires at: 1752838891074
[debug] [2025-07-18T11:15:15.632Z] >>> [apiv2][query] POST https://firebaserules.googleapis.com/v1/projects/bgw-mrp-system:test [none]
[debug] [2025-07-18T11:15:15.632Z] >>> [apiv2][body] POST https://firebaserules.googleapis.com/v1/projects/bgw-mrp-system:test [omitted]
[debug] [2025-07-18T11:15:16.438Z] <<< [apiv2][status] POST https://firebaserules.googleapis.com/v1/projects/bgw-mrp-system:test 200
[debug] [2025-07-18T11:15:16.438Z] <<< [apiv2][body] POST https://firebaserules.googleapis.com/v1/projects/bgw-mrp-system:test {}
[info] +  firebase.storage: rules file storage.rules compiled successfully 
[debug] [2025-07-18T11:15:16.439Z] Checked if tokens are valid: true, expires at: 1752838891074
[debug] [2025-07-18T11:15:16.440Z] Checked if tokens are valid: true, expires at: 1752838891074
[debug] [2025-07-18T11:15:16.440Z] >>> [apiv2][query] GET https://firebaserules.googleapis.com/v1/projects/bgw-mrp-system/releases pageSize=10&pageToken=
[debug] [2025-07-18T11:15:17.148Z] <<< [apiv2][status] GET https://firebaserules.googleapis.com/v1/projects/bgw-mrp-system/releases 200
[debug] [2025-07-18T11:15:17.148Z] <<< [apiv2][body] GET https://firebaserules.googleapis.com/v1/projects/bgw-mrp-system/releases {"releases":[{"name":"projects/bgw-mrp-system/releases/cloud.firestore","rulesetName":"projects/bgw-mrp-system/rulesets/7bc0105a-5212-448e-810d-fb4f31d34de4","createTime":"2025-02-26T12:06:54.998288Z","updateTime":"2025-06-25T15:49:28.481099Z"},{"name":"projects/bgw-mrp-system/releases/firebase.storage/bgw-mrp-system","rulesetName":"projects/bgw-mrp-system/rulesets/9682b47a-e13d-4c73-858e-078c414dfbae","createTime":"2025-05-19T09:07:46.669458Z","updateTime":"2025-05-19T09:07:46.669458Z"},{"name":"projects/bgw-mrp-system/releases/firebase.storage/bgw-mrp-system.firebasestorage.app","rulesetName":"projects/bgw-mrp-system/rulesets/5d894037-261b-4210-af5c-ff911645dea3","createTime":"2025-04-29T10:15:41.823369Z","updateTime":"2025-07-18T11:14:21.236410Z"}]}
[debug] [2025-07-18T11:15:17.157Z] Checked if tokens are valid: true, expires at: 1752838891074
[debug] [2025-07-18T11:15:17.157Z] Checked if tokens are valid: true, expires at: 1752838891074
[debug] [2025-07-18T11:15:17.157Z] >>> [apiv2][query] GET https://firebaserules.googleapis.com/v1/projects/bgw-mrp-system/rulesets/9682b47a-e13d-4c73-858e-078c414dfbae [none]
[debug] [2025-07-18T11:15:17.865Z] <<< [apiv2][status] GET https://firebaserules.googleapis.com/v1/projects/bgw-mrp-system/rulesets/9682b47a-e13d-4c73-858e-078c414dfbae 200
[debug] [2025-07-18T11:15:17.866Z] <<< [apiv2][body] GET https://firebaserules.googleapis.com/v1/projects/bgw-mrp-system/rulesets/9682b47a-e13d-4c73-858e-078c414dfbae [omitted]
[info] i  storage: uploading rules storage.rules... 
[debug] [2025-07-18T11:15:17.867Z] Checked if tokens are valid: true, expires at: 1752838891074
[debug] [2025-07-18T11:15:17.867Z] Checked if tokens are valid: true, expires at: 1752838891074
[debug] [2025-07-18T11:15:17.867Z] >>> [apiv2][query] POST https://firebaserules.googleapis.com/v1/projects/bgw-mrp-system/rulesets [none]
[debug] [2025-07-18T11:15:17.867Z] >>> [apiv2][body] POST https://firebaserules.googleapis.com/v1/projects/bgw-mrp-system/rulesets [omitted]
[debug] [2025-07-18T11:15:18.725Z] <<< [apiv2][status] POST https://firebaserules.googleapis.com/v1/projects/bgw-mrp-system/rulesets 200
[debug] [2025-07-18T11:15:18.725Z] <<< [apiv2][body] POST https://firebaserules.googleapis.com/v1/projects/bgw-mrp-system/rulesets {"name":"projects/bgw-mrp-system/rulesets/a852e407-8a41-4bba-8e74-e009964c2b6b","source":{"files":[{"content":"rules_version = '2';\r\nservice firebase.storage {\r\n  match /b/{bucket}/o {\r\n    // Reguła dla katalogu z raportami błędów - pozwala autoryzowanym użytkownikom na przesyłanie i pobieranie\r\n    match /bugReports/{reportId}/{fileName} {\r\n      allow read: if request.auth != null;\r\n      allow write: if request.auth != null;\r\n    }\r\n    \r\n    // Reguła dla certyfikatów partii - pozwala autoryzowanym użytkownikom na przesyłanie i pobieranie certyfikatów\r\n    match /batchCertificates/{batchId}/{fileName} {\r\n      allow read: if request.auth != null;\r\n      allow write: if request.auth != null;\r\n    }\r\n    \r\n    // Reguła dla nowego katalogu certyfikatów - pozwala autoryzowanym użytkownikom na przesyłanie i pobieranie\r\n    match /certificates/{batchId}/{fileName} {\r\n      allow read: if request.auth != null;\r\n      allow write: if request.auth != null;\r\n    }\r\n    \r\n    // Reguła dla załączników asystenta AI - pozwala autoryzowanym użytkownikom na przesyłanie i pobieranie plików\r\n    match /ai-attachments/{userId}/{conversationId}/{fileName} {\r\n      allow read: if request.auth != null && request.auth.uid == userId;\r\n      allow write: if request.auth != null && request.auth.uid == userId;\r\n    }\r\n    \r\n    // Reguła dla załączników do zamówień zakupu - pozwala autoryzowanym użytkownikom na przesyłanie i pobieranie\r\n    match /purchase-order-attachments/{orderId}/{fileName} {\r\n      allow read: if request.auth != null;\r\n      allow write: if request.auth != null;\r\n    }\r\n    \r\n    // Reguła dla załączników badań klinicznych - pozwala autoryzowanym użytkownikom na przesyłanie i pobieranie\r\n    match /clinical-research-attachments/{taskId}/{fileName} {\r\n      allow read: if request.auth != null;\r\n      allow write: if request.auth != null;\r\n    }\r\n    \r\n    // Reguła dla dodatkowych załączników - pozwala autoryzowanym użytkownikom na przesyłanie i pobieranie\r\n    match /additional-attachments/{taskId}/{fileName} {\r\n      allow read: if request.auth != null;\r\n      allow write: if request.auth != null;\r\n    }\r\n    \r\n    // Reguła dla formularzy - pozwala autoryzowanym użytkownikom na przesyłanie i pobieranie plików z formularzy\r\n    match /forms/{formType}/{moNumber}/{fileName} {\r\n      allow read: if request.auth != null;\r\n      allow write: if request.auth != null;\r\n    }\r\n    \r\n    // Reguła dla dowodów dostawy\r\n    match /delivery_proofs/{orderId}/{fileName} {\r\n      allow read: if request.auth != null;\r\n      allow write: if request.auth != null;\r\n    }\r\n    \r\n    // Domyślna reguła - blokuje dostęp bez szczegółowych uprawnień\r\n    match /{allPaths=**} {\r\n      allow read, write: if false;\r\n    }\r\n  }\r\n} ","name":"storage.rules"}]},"createTime":"2025-07-18T11:15:17.176815Z","metadata":{"services":["firebase.storage"]}}
[debug] [2025-07-18T11:15:18.727Z] [rules] created ruleset projects/bgw-mrp-system/rulesets/a852e407-8a41-4bba-8e74-e009964c2b6b
[debug] [2025-07-18T11:15:18.727Z] [rules] releasing firebase.storage/bgw-mrp-system.firebasestorage.app with ruleset projects/bgw-mrp-system/rulesets/a852e407-8a41-4bba-8e74-e009964c2b6b
[debug] [2025-07-18T11:15:18.727Z] Checked if tokens are valid: true, expires at: 1752838891074
[debug] [2025-07-18T11:15:18.728Z] Checked if tokens are valid: true, expires at: 1752838891074
[debug] [2025-07-18T11:15:18.728Z] >>> [apiv2][query] PATCH https://firebaserules.googleapis.com/v1/projects/bgw-mrp-system/releases/firebase.storage/bgw-mrp-system.firebasestorage.app [none]
[debug] [2025-07-18T11:15:18.728Z] >>> [apiv2][body] PATCH https://firebaserules.googleapis.com/v1/projects/bgw-mrp-system/releases/firebase.storage/bgw-mrp-system.firebasestorage.app {"release":{"name":"projects/bgw-mrp-system/releases/firebase.storage/bgw-mrp-system.firebasestorage.app","rulesetName":"projects/bgw-mrp-system/rulesets/a852e407-8a41-4bba-8e74-e009964c2b6b"}}
[debug] [2025-07-18T11:15:19.612Z] <<< [apiv2][status] PATCH https://firebaserules.googleapis.com/v1/projects/bgw-mrp-system/releases/firebase.storage/bgw-mrp-system.firebasestorage.app 200
